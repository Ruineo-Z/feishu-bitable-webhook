# 技术决策：飞书多维表格事件订阅方式选择

## 需求背景

监听飞书多维表格数据的新增、修改、删除事件，触发自定义业务操作，提高业务自动化覆盖率。

## 飞书事件订阅方式

飞书提供两种事件订阅回调方式：

### 方式一：使用长连接接收事件

基于 WebSocket 全双工通道，通过集成飞书 SDK 与开放平台建立长连接。

### 方式二：将事件发送至开发者服务器

传统 Webhook 模式，需要提供服务器公网地址，事件触发时飞书发送 HTTP POST 请求。

## 决策结果

**选择：方式一（长连接接收事件）**

## 选择原因

| 对比项 | 长连接（WebSocket） | Webhook |
|--------|---------------------|---------|
| 公网要求 | 无需 | 必须有公网服务器 |
| 开发难度 | 低（SDK封装） | 高（需自己处理验签解密） |
| 本地调试 | ✅ 可直接开发 | ❌ 需内网穿透 |
| 安全性 | 内置加密 | 需自行配置 |
| 响应时效 | 实时推送 | 实时推送 |
| 适用应用 | 仅自建应用 | 自建+商店应用 |

### 核心优势

1. **开发效率高** - 5分钟即可完成配置，无需处理复杂的加密验签逻辑
2. **成本低** - 不需要购买公网服务器，开发阶段可直接本地运行
3. **调试便捷** - 无需内网穿透工具，本地开发环境即可接收事件
4. **安全可靠** - SDK 内置加密传输和鉴权逻辑

### 注意事项

- 仅支持企业自建应用
- 每应用最多50个连接
- 消息处理需在3秒内完成
- 多客户端部署时采用随机推送策略

## 目标事件类型

- `bitable.record.*` - 多维表记录变更事件
- 支持：新增、修改、删除操作

## 参考文档

- [飞书事件订阅概述](https://open.feishu.cn/document/server-docs/event-subscription-guide/overview)
- [使用长连接接收事件](https://open.feishu.cn/document/ukTMukTMukTM/uYDNxYjL2QTM24iN0EjN/event-subscription-configure-/request-url-configuration-case)
